<!DOCTYPE html>
<html>
<head>
  <title>Private Chat</title>
</head>
<body>

<h3>Private Chat</h3>

<!-- Receiver dropdown (auto filled) -->
<select id="receiver"></select>

<br><br>

<input id="msg" placeholder="Type message">
<button onclick="send()">Send</button>

<hr>

<div id="chat"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io("https://bappa-s-web.onrender.com");

  // logged-in userId
  const userId = localStorage.getItem("userId");
  if (!userId) {
    alert("Please login first");
    location.href = "/";
  }

  // ðŸ”¹ TEMP USER LIST (learning stage)
  // à¦ªà¦°à§‡ à¦à¦Ÿà¦¾ DB à¦¥à§‡à¦•à§‡ à¦†à¦¸à¦¬à§‡
  const USERS = [
    { id: "695ae558cede022179643013", name: "Bondhu" },
    { id: "695ae999cede022179643099", name: "Rahul" }
  ];

  // à¦¨à¦¿à¦œà§‡à¦° à¦¨à¦¾à¦® à¦¬à¦¾à¦¦ à¦¦à¦¿à§Ÿà§‡ dropdown à¦¬à¦¾à¦¨à¦¾à¦¨à§‹
  const receiverSelect = document.getElementById("receiver");
  USERS.filter(u => u.id !== userId).forEach(u => {
    const opt = document.createElement("option");
    opt.value = u.id;
    opt.textContent = u.name;
    receiverSelect.appendChild(opt);
  });

  // online register
  socket.emit("addUser", userId);

  function send() {
    const receiverId = receiverSelect.value;
    const text = document.getElementById("msg").value;
    if (!text) return;

    socket.emit("sendMessage", {
      senderId: userId,
      receiverId,
      text
    });

    document.getElementById("chat").innerHTML +=
      `<p><b>You:</b> ${text}</p>`;

    document.getElementById("msg").value = "";
  }

  // receive private message
  socket.on("getMessage", (data) => {
    document.getElementById("chat").innerHTML +=
      `<p><b>Them:</b> ${data.text}</p>`;
  });
</script>

</body>
</html>
