<!DOCTYPE html>
<html>
<head>
  <title>Bondhu Feed</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 10px;
    }
    .post {
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .username {
      font-weight: bold;
      color: #007bff;
      cursor: pointer;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-bottom: 6px;
    }
    button {
      padding: 6px 10px;
      margin-right: 5px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<h3 id="wallet">ðŸ’° Wallet: â‚¹0</h3>
<hr>

<h3 id="welcome"></h3>

<h2>Create Post</h2>
<input id="postText" placeholder="What's on your mind?">
<button onclick="handlePost()">Post</button>

<br><br>
<button onclick="goChat()">ðŸ’¬ Open Personal Chat</button>
<button onclick="logout()">ðŸšª Logout</button>

<hr>

<h2>Feed</h2>
<div id="feed"></div>

<script src="app.js"></script>
<script>
/* ================= CONFIG ================= */
const API = "https://bappa-s-web.onrender.com";

/* ================= LOGIN CHECK ================= */
const userId = localStorage.getItem("userId");
const userName = localStorage.getItem("userName");

if (!userId) {
  alert("Please login first");
  location.href = "/";
}

/* ================= WELCOME ================= */
document.getElementById("welcome").innerText =
  "Welcome, " + (userName || "User");

/* ================= WALLET ================= */
async function loadWallet(){
  const res = await fetch(API + "/users/wallet/" + userId);
  const data = await res.json();
  document.getElementById("wallet").innerText =
    "ðŸ’° Wallet: â‚¹" + data.wallet;
}

/* ================= LOAD FEED ================= */
async function loadFeed(){
  const res = await fetch(API + "/post");
  const posts = await res.json();

  const feed = document.getElementById("feed");
  feed.innerHTML = "";

  posts.forEach(p => {
    feed.innerHTML += `
      <div class="post">
        <p class="username" onclick="openProfile('${p.userId._id}')">
          ðŸ‘¤ ${p.userId.name}
        </p>
        <p>${p.text}</p>
      </div>
    `;
  });
}

/* ================= CREATE POST (FIXED) ================= */
async function handlePost(){
  const text = postText.value.trim();
  if (!text) return;

  await fetch(API + "/post", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({
      userId,
      text
    })
  });

  postText.value = "";
  loadFeed();       // âœ… IMPORTANT FIX
}

/* ================= OPEN PROFILE ================= */
function openProfile(uid){
  location.href = "profile.html?uid=" + uid;
}

/* ================= NAV ================= */
function goChat(){
  location.href = "chat.html";
}

/* ================= INIT ================= */
loadWallet();
loadFeed();
</script>

</body>
</html>
